{% extends 'task_manager/base.html' %}

{% block title %}
Projects List
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th class="col-3">
                        <button class="sorter">
                            <p>Название</p>
                            <span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                                  <path d="M4 8H12M2 4H14M6 12H10" stroke="#A6A6A6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                        </button>
                    </th>
                    <th class="col-3">
                        <button class="sorter">
                            <p>Статус</p>
                            <span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                                  <path d="M4 8H12M2 4H14M6 12H10" stroke="#A6A6A6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                        </button>
                    </th>
                    <th class="col-4">
                        <button class="sorter">
                            <p>Здания и сооружения</p>
                            <span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                                  <path d="M4 8H12M2 4H14M6 12H10" stroke="#A6A6A6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                        </button>
                    </th>
                    <th class="col-3">
                        <button class="sorter">
                            <p>Разделы</p>
                            <span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                                  <path d="M4 8H12M2 4H14M6 12H10" stroke="#A6A6A6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                        </button>
                    </th>
                    <th class="col">
                        <button class="sorter">
                            <p>Действия</p>
                            <span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                                  <path d="M4 8H12M2 4H14M6 12H10" stroke="#A6A6A6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                        </button>
                    </th>
                </tr>
            </thead>
            <tbody>
                {% for project in projects %}
                <tr>
                    <td>
                        <!-- Ссылка на детальную страницу проекта -->
<!--                         href="{% url 'project-detail' project.pk %}" -->
                        <p>
                            {{ project.title }}
                        </p>
                    </td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>
                        <button class="edit" data-toggle="modal" data-target="#editProjectModal" data-id="{{ project.pk }}" data-title="{{ project.title }}" data-status="{{ project.status_id }}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                                <path d="M1.31128 14.1984C1.34932 13.8561 1.36833 13.685 1.42012 13.525C1.46606 13.3831 1.53098 13.2481 1.6131 13.1235C1.70566 12.9832 1.82742 12.8614 2.07094 12.6179L13.0031 1.68577C13.9174 0.77141 15.3999 0.771411 16.3143 1.68577C17.2286 2.60013 17.2286 4.0826 16.3142 4.99696L5.38213 15.9291C5.1386 16.1726 5.01684 16.2943 4.87648 16.3869C4.75194 16.469 4.61688 16.5339 4.47496 16.5799C4.315 16.6317 4.14385 16.6507 3.80157 16.6887L1 17L1.31128 14.1984Z" stroke="#16AEDC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Add Project Modal -->
<div class="modal fade" id="addProjectModal" tabindex="-1" aria-labelledby="addProjectModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" enctype="multipart/form-data" action="{% url 'project-create' %}">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title" id="addProjectModalLabel">Add Project</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    {{ form.as_p }}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Project Modal -->
<!--<div class="modal fade" id="deleteProjectModal" tabindex="-1" aria-labelledby="deleteProjectModalLabel" aria-hidden="true">-->
<!--    <div class="modal-dialog">-->
<!--        <div class="modal-content">-->
<!--            <div class="modal-header">-->
<!--                <h5 class="modal-title" id="deleteProjectModalLabel">Confirm Delete</h5>-->
<!--                <button type="button" class="close" data-dismiss="modal" aria-label="Close">-->
<!--                    <span aria-hidden="true">&times;</span>-->
<!--                </button>-->
<!--            </div>-->
<!--            <div class="modal-body">-->
<!--                Are you sure you want to delete this project?-->
<!--            </div>-->
<!--            <div class="modal-footer">-->
<!--                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>-->
<!--                <form id="deleteProjectForm" method="post">-->
<!--                    {% csrf_token %}-->
<!--                    <button type="submit" class="btn btn-danger">Delete</button>-->
<!--                </form>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->
<div class="modal fade" id="editProjectModal" tabindex="-1" aria-labelledby="editProjectModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="editProjectForm" method="post" enctype="multipart/form-data"
                  action="{% url 'project-update' project.pk %}">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title" id="editProjectModalLabel">Edit Project</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="id_title">Project Title</label>
                        <input type="text" name="title" class="form-control" id="id_title" value="{{ project.title }}">
                    </div>
                    <div class="form-group">
                        <label for="id_status">Status</label>
                        <select name="status" class="form-control" id="id_status">
                            {% for status in project_status %}
                            <option value="{{ status.pk }}"
                                    {% if status.pk == project.status_id %}selected{% endif %}>
                                {{ status.title }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="id_buildings">Buildings</label>
                        <select name="buildings" class="form-control" id="id_buildings" multiple>
                            {% for building in buildings %}
                            <option value="{{ building.pk }}" {% if building in project_buildings %}selected{% endif %}>
                                {{ building.title }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <!-- Добавляем возможность выбора секций в форме -->
                    <div class="form-group">
                        <label for="id_sections">Sections</label>
                        <select name="sections" class="form-control" id="id_sections" multiple>
                            {% for section in sections %}
                            <option value="{{ section.pk }}" {% if section.pk in project_sections %}selected{% endif %}>{{ section.title }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // Handle Delete Project modal display
    // $('#deleteProjectModal').on('show.bs.modal', function (event) {
    //     var button = $(event.relatedTarget);
    //     var projectId = button.data('id');
    //
    //     // Update the form action URL
    //     $('#deleteProjectForm').attr('action', '/projects/' + projectId + '/delete/');
    // });
</script>
{% endblock %}
