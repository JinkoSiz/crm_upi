{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Task Manager{% endblock %}</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body>
<div class="container">
    <header>
        <img src="https://s3.timeweb.com/7777fb51-34f4640c-d71e-4ace-b57e-e7997a1f4952/03_logo1.svg" alt="Logo" class="logo">
        <div class="header-info">
            <div class="header-info-user">
                <p class="header-info-user-name">{{ user.first_name }} {{ user.last_name }}</p>
                <p class="header-info-user-position">{{ user.role }}</p>
            </div>
            <span class="header-info-img">
                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="41" viewBox="0 0 40 41" fill="none">
                    <g clip-path="url(#clip0_395_668)">
                      <mask id="mask0_395_668" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="40" height="41">
                        <path d="M40 20.5C40 9.4543 31.0457 0.5 20 0.5C8.9543 0.5 0 9.4543 0 20.5C0 31.5457 8.9543 40.5 20 40.5C31.0457 40.5 40 31.5457 40 20.5Z" fill="white"/>
                      </mask>
                      <g mask="url(#mask0_395_668)">
                        <path d="M40 0.500031H0V40.5H40V0.500031Z" fill="#16AEDC"/>
                        <path d="M45.1916 -0.677752L13.4301 3.22207C9.04477 3.76052 5.92625 7.75205 6.4647 12.1374L10.3645 43.8989C10.903 48.2842 14.8945 51.4027 19.2798 50.8643L51.0413 46.9645C55.4267 46.426 58.5452 42.4345 58.0067 38.0491L54.1069 6.28766C53.5685 1.90232 49.5769 -1.2162 45.1916 -0.677752Z" fill="#EFF8FF"/>
                        <path d="M20.7339 22.8926C23.0112 23.8859 25.2304 23.7696 27.3914 22.5437L20.7339 22.8926Z" fill="#3287FE"/>
                        <path d="M20.7339 22.8926C23.0112 23.8859 25.2304 23.7696 27.3914 22.5437" stroke="#3287FE" stroke-width="1.42857" stroke-linecap="round"/>
                        <path d="M16.7305 16.0238C16.7306 16.0236 16.732 16.024 16.7346 16.0255C16.7319 16.0247 16.7305 16.024 16.7305 16.0238ZM16.7592 16.0454C16.7647 16.0509 16.7711 16.0577 16.7781 16.0662C16.831 16.1295 16.8891 16.2505 16.8979 16.4175C16.9066 16.5845 16.8615 16.7109 16.8155 16.7794C16.8094 16.7885 16.8038 16.796 16.7988 16.802C16.7933 16.7965 16.787 16.7897 16.7799 16.7812C16.727 16.7179 16.6689 16.5969 16.6601 16.4299C16.6514 16.2629 16.6966 16.1365 16.7425 16.068C16.7487 16.0589 16.7542 16.0514 16.7592 16.0454ZM16.7726 16.8265C16.7726 16.8263 16.7738 16.8254 16.7765 16.8243C16.774 16.8261 16.7727 16.8266 16.7726 16.8265ZM16.8234 16.8219C16.8262 16.8227 16.8275 16.8234 16.8275 16.8236C16.8275 16.8238 16.8261 16.8234 16.8234 16.8219ZM16.7815 16.0231C16.784 16.0213 16.7854 16.0208 16.7854 16.0209C16.7855 16.0211 16.7842 16.022 16.7815 16.0231Z" fill="#3287FE" stroke="#3287FE" stroke-width="1.42857"/>
                        <path d="M30.0455 15.3262C30.0455 15.3261 30.0469 15.3265 30.0496 15.3279C30.0468 15.3272 30.0455 15.3264 30.0455 15.3262ZM30.0741 15.3478C30.0797 15.3533 30.086 15.3601 30.0931 15.3686C30.1459 15.4319 30.2041 15.5529 30.2128 15.7199C30.2216 15.8869 30.1764 16.0133 30.1304 16.0818C30.1243 16.0909 30.1187 16.0984 30.1138 16.1045C30.1082 16.099 30.1019 16.0921 30.0948 16.0837C30.042 16.0204 29.9838 15.8994 29.9751 15.7324C29.9663 15.5654 30.0115 15.4389 30.0575 15.3704C30.0636 15.3613 30.0692 15.3539 30.0741 15.3478ZM30.0876 16.1289C30.0875 16.1287 30.0888 16.1278 30.0914 16.1268C30.0889 16.1285 30.0876 16.1291 30.0876 16.1289ZM30.1383 16.1243C30.1411 16.1251 30.1424 16.1258 30.1424 16.126C30.1424 16.1262 30.141 16.1258 30.1383 16.1243ZM30.0965 15.3255C30.099 15.3237 30.1003 15.3232 30.1004 15.3234C30.1004 15.3235 30.0991 15.3244 30.0965 15.3255Z" fill="#3287FE" stroke="#3287FE" stroke-width="1.42857"/>
                      </g>
                    </g>
                    <defs>
                      <clipPath id="clip0_395_668">
                        <rect width="40" height="40" fill="white" transform="translate(0 0.5)"/>
                      </clipPath>
                    </defs>
                  </svg>
            </span>
            <a href="{% url 'logout' %}" class="header-info-log-out">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="21" viewBox="0 0 20 21" fill="currentColor">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M16.875 9.5625H6.25C5.7325 9.5625 5.3125 9.9825 5.3125 10.5C5.3125 11.0175 5.7325 11.4375 6.25 11.4375H16.875C17.3925 11.4375 17.8125 11.0175 17.8125 10.5C17.8125 9.9825 17.3925 9.5625 16.875 9.5625Z" fill="currentColor"/>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M15.0372 14.2876L18.1622 11.1626C18.5284 10.7963 18.5284 10.2038 18.1622 9.83755L15.0372 6.71255C14.6722 6.3463 14.0772 6.3463 13.7122 6.71255C13.3459 7.07755 13.3459 7.67255 13.7122 8.03755L16.1734 10.5001L13.7122 12.9626C13.3459 13.3276 13.3459 13.9226 13.7122 14.2876C14.0772 14.6538 14.6722 14.6538 15.0372 14.2876Z" fill="currentColor"/>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M10 17.0625H3.75C3.6675 17.0625 3.5875 17.03 3.52875 16.9713C3.47 16.9125 3.4375 16.8325 3.4375 16.75V4.25C3.4375 4.1675 3.47 4.0875 3.52875 4.02875C3.5875 3.97 3.6675 3.9375 3.75 3.9375H10C10.5175 3.9375 10.9375 3.5175 10.9375 3C10.9375 2.4825 10.5175 2.0625 10 2.0625C8.07875 2.0625 5.67125 2.0625 3.75 2.0625C3.17 2.0625 2.61375 2.2925 2.20375 2.70375C1.7925 3.11375 1.5625 3.67 1.5625 4.25V16.75C1.5625 17.33 1.7925 17.8863 2.20375 18.2963C2.61375 18.7075 3.17 18.9375 3.75 18.9375H10C10.5175 18.9375 10.9375 18.5175 10.9375 18C10.9375 17.4825 10.5175 17.0625 10 17.0625Z" fill="currentColor"/>
                </svg>
            </a>
        </div>
    </header>

    <div id="adminDiv"></div>

    <nav class="admin-main-navigation">
        <ul>
            <li data-cid="timelogs">
                <a href="{% url 'timelog-list' %}">
                    <span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                          <g clip-path="url(#clip0_169_2415)">
                            <path d="M9 0C7.21997 0 5.47991 0.527841 3.99987 1.51677C2.51983 2.50571 1.36628 3.91131 0.685088 5.55585C0.00389957 7.20038 -0.17433 9.00998 0.172937 10.7558C0.520204 12.5016 1.37737 14.1053 2.63604 15.364C3.89472 16.6226 5.49836 17.4798 7.24419 17.8271C8.99002 18.1743 10.7996 17.9961 12.4442 17.3149C14.0887 16.6337 15.4943 15.4802 16.4832 14.0001C17.4722 12.5201 18 10.78 18 9C17.9974 6.61384 17.0484 4.32616 15.3611 2.63889C13.6738 0.951621 11.3862 0.00258081 9 0ZM9 16.5C7.51664 16.5 6.0666 16.0601 4.83323 15.236C3.59986 14.4119 2.63856 13.2406 2.07091 11.8701C1.50325 10.4997 1.35473 8.99168 1.64411 7.53682C1.9335 6.08197 2.64781 4.74559 3.6967 3.6967C4.7456 2.64781 6.08197 1.9335 7.53683 1.64411C8.99168 1.35472 10.4997 1.50325 11.8701 2.0709C13.2406 2.63856 14.4119 3.59985 15.236 4.83322C16.0601 6.06659 16.5 7.51664 16.5 9C16.4978 10.9885 15.7069 12.8948 14.3009 14.3009C12.8948 15.7069 10.9885 16.4978 9 16.5Z" fill="currentColor"/>
                            <path d="M8.99984 4.5C8.80093 4.5 8.61016 4.57902 8.46951 4.71967C8.32886 4.86032 8.24984 5.05109 8.24984 5.25V8.49375L5.72159 10.0778C5.55251 10.1834 5.43232 10.3518 5.38745 10.5461C5.34258 10.7403 5.37672 10.9444 5.48234 11.1135C5.58796 11.2826 5.75642 11.4028 5.95066 11.4476C6.1449 11.4925 6.34901 11.4584 6.51809 11.3527L9.39809 9.55275C9.5069 9.48457 9.59639 9.3896 9.65798 9.27693C9.71957 9.16425 9.7512 9.03765 9.74984 8.90925V5.25C9.74984 5.05109 9.67082 4.86032 9.53017 4.71967C9.38952 4.57902 9.19875 4.5 8.99984 4.5Z" fill="currentColor"/>
                          </g>
                          <defs>
                            <clipPath id="clip0_169_2415">
                              <rect width="18" height="18" fill="currentColor"/>
                            </clipPath>
                          </defs>
                        </svg>
                    </span>
                    <p>Логи времени</p>
                </a>
            </li>
            <li data-cid="users">
                <a href="{% url 'user-list' %}">
                    <span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                          <g clip-path="url(#clip0_169_2227)">
                            <path d="M9 0C4.03725 0 0 4.03725 0 9C0 13.9628 4.03725 18 9 18C13.9628 18 18 13.9628 18 9C18 4.03725 13.9628 0 9 0ZM6 15.873V14.25C6 13.836 6.33675 13.5 6.75 13.5H11.25C11.6632 13.5 12 13.836 12 14.25V15.873C11.0805 16.2757 10.0665 16.5 9 16.5C7.9335 16.5 6.9195 16.2757 6 15.873ZM13.5 14.9963V14.25C13.5 13.0095 12.4905 12 11.25 12H6.75C5.5095 12 4.5 13.0095 4.5 14.25V14.9963C2.67975 13.6268 1.5 11.4488 1.5 9C1.5 4.8645 4.8645 1.5 9 1.5C13.1355 1.5 16.5 4.8645 16.5 9C16.5 11.448 15.3202 13.6268 13.5 14.9963ZM9 4.5C7.3455 4.5 6 5.8455 6 7.5C6 9.1545 7.3455 10.5 9 10.5C10.6545 10.5 12 9.1545 12 7.5C12 5.8455 10.6545 4.5 9 4.5ZM9 9C8.17275 9 7.5 8.32725 7.5 7.5C7.5 6.67275 8.17275 6 9 6C9.82725 6 10.5 6.67275 10.5 7.5C10.5 8.32725 9.82725 9 9 9Z" fill="currentColor"/>
                          </g>
                          <defs>
                            <clipPath id="clip0_169_2227">
                              <rect width="18" height="18" fill="currentColor"/>
                            </clipPath>
                          </defs>
                        </svg>
                    </span>
                    <p>Пользователи</p>
                </a>
            </li>
            <li data-cid="projects">
                <a href="{% url 'project-list' %}">
                    <span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                          <g clip-path="url(#clip0_169_2231)">
                            <path d="M16.653 1.6215C15.7973 0.907503 14.6775 0.614253 13.5795 0.810753L10.713 1.332C10.0283 1.45725 9.4335 1.8075 9 2.29875C8.5665 1.8075 7.97175 1.4565 7.28625 1.332L4.4205 0.810753C3.32475 0.613503 2.2035 0.907503 1.347 1.6215C0.4905 2.33625 0 3.3855 0 4.50075V12.5948C0 14.4075 1.29525 15.9593 3.0795 16.284L7.7925 17.1413C8.193 17.214 8.5965 17.2508 9 17.2508C9.4035 17.2508 9.807 17.2148 10.2075 17.1413L14.9213 16.284C16.7055 15.9593 18 14.4075 18 12.5948V4.50075C18 3.3855 17.5088 2.33625 16.653 1.6215ZM8.25 15.696C8.187 15.687 8.124 15.6765 8.061 15.6653L3.348 14.808C2.277 14.613 1.5 13.6823 1.5 12.594V4.50075C1.5 3.83175 1.79475 3.2025 2.3085 2.7735C2.71725 2.43225 3.22575 2.25075 3.74775 2.25075C3.882 2.25075 4.01775 2.26275 4.15275 2.2875L7.0185 2.80875C7.7325 2.9385 8.25075 3.5595 8.25075 4.28475V15.6968L8.25 15.696ZM16.5 12.5948C16.5 13.683 15.723 14.6138 14.6528 14.8088L9.93975 15.666C9.87675 15.6773 9.81375 15.6878 9.75075 15.6968V4.284C9.75075 3.55875 10.269 2.9385 10.9823 2.808L13.848 2.28675C14.5065 2.16525 15.1778 2.3445 15.6923 2.77275C16.206 3.20175 16.5007 3.831 16.5007 4.5V12.594L16.5 12.5948ZM4.125 9.75V5.25C4.125 4.836 4.461 4.5 4.875 4.5C5.289 4.5 5.625 4.836 5.625 5.25V9.75C5.625 10.164 5.289 10.5 4.875 10.5C4.461 10.5 4.125 10.164 4.125 9.75ZM6 12.375C6 12.996 5.496 13.5 4.875 13.5C4.254 13.5 3.75 12.996 3.75 12.375C3.75 11.754 4.254 11.25 4.875 11.25C5.496 11.25 6 11.754 6 12.375Z" fill="currentColor"/>
                          </g>
                          <defs>
                            <clipPath id="clip0_169_2231">
                              <rect width="18" height="18" fill="currentColor"/>
                            </clipPath>
                          </defs>
                        </svg>
                    </span>
                    <p>Справочники</p>
                </a>
            </li>
            <li data-cid="reports">
                <a href="{% url 'reports' %}">
                    <span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                          <g clip-path="url(#clip0_169_2235)">
                            <path d="M12.75 10.5C12.75 10.6989 12.671 10.8897 12.5303 11.0303C12.3897 11.171 12.1989 11.25 12 11.25H6C5.80109 11.25 5.61032 11.171 5.46967 11.0303C5.32902 10.8897 5.25 10.6989 5.25 10.5C5.25 10.3011 5.32902 10.1103 5.46967 9.96967C5.61032 9.82902 5.80109 9.75 6 9.75H12C12.1989 9.75 12.3897 9.82902 12.5303 9.96967C12.671 10.1103 12.75 10.3011 12.75 10.5ZM9.75 12.75H6C5.80109 12.75 5.61032 12.829 5.46967 12.9697C5.32902 13.1103 5.25 13.3011 5.25 13.5C5.25 13.6989 5.32902 13.8897 5.46967 14.0303C5.61032 14.171 5.80109 14.25 6 14.25H9.75C9.94891 14.25 10.1397 14.171 10.2803 14.0303C10.421 13.8897 10.5 13.6989 10.5 13.5C10.5 13.3011 10.421 13.1103 10.2803 12.9697C10.1397 12.829 9.94891 12.75 9.75 12.75ZM16.5 7.86375V14.25C16.4988 15.2442 16.1033 16.1973 15.4003 16.9003C14.6973 17.6033 13.7442 17.9988 12.75 18H5.25C4.2558 17.9988 3.30267 17.6033 2.59966 16.9003C1.89666 16.1973 1.50119 15.2442 1.5 14.25V3.75C1.50119 2.75581 1.89666 1.80267 2.59966 1.09967C3.30267 0.396663 4.2558 0.00119292 5.25 2.02772e-06H8.63625C9.32596 -0.00177317 10.0092 0.133193 10.6464 0.397096C11.2836 0.661 11.8622 1.04861 12.3488 1.5375L14.9618 4.152C15.4509 4.63818 15.8388 5.21659 16.1028 5.85373C16.3669 6.49087 16.5019 7.17407 16.5 7.86375ZM11.2882 2.598C11.0522 2.36937 10.7872 2.17269 10.5 2.013V5.25C10.5 5.44891 10.579 5.63968 10.7197 5.78033C10.8603 5.92098 11.0511 6 11.25 6H14.487C14.3272 5.71289 14.1303 5.44811 13.9012 5.2125L11.2882 2.598ZM15 7.86375C15 7.74 14.976 7.6215 14.9647 7.5H11.25C10.6533 7.5 10.081 7.26295 9.65901 6.84099C9.23705 6.41904 9 5.84674 9 5.25V1.53525C8.8785 1.524 8.75925 1.5 8.63625 1.5H5.25C4.65326 1.5 4.08097 1.73706 3.65901 2.15901C3.23705 2.58097 3 3.15326 3 3.75V14.25C3 14.8467 3.23705 15.419 3.65901 15.841C4.08097 16.2629 4.65326 16.5 5.25 16.5H12.75C13.3467 16.5 13.919 16.2629 14.341 15.841C14.7629 15.419 15 14.8467 15 14.25V7.86375Z" fill="currentColor"/>
                          </g>
                          <defs>
                            <clipPath id="clip0_169_2235">
                              <rect width="18" height="18" fill="currentColor"/>
                            </clipPath>
                          </defs>
                        </svg>
                    </span>
                    <p>Отчеты</p>
                </a>
            </li>
        </ul>
    </nav>
    <nav class="handbooks">
        <ul>
            <li class="data-list" data-cid="projects"><a href="{% url 'project-list' %}">Проекты</a></li>
            <li class="data-list" data-cid="sections"><a href="{% url 'section-list' %}">Разделы</a></li>
            <li class="data-list" data-cid="marks"><a href="{% url 'mark-list' %}">Марки</a></li>
            <li class="data-list" data-cid="departments"><a href="{% url 'department-list' %}">Отделы</a></li>
            <li class="data-list" data-cid="roles"><a href="{% url 'role-list' %}">Должности</a></li>
        </ul>
        <button data-cid="projects" type="button"  class="add-depart" data-toggle="modal" data-target="#projectModal">Добавить проект</button>
        <button data-cid="sections" type="button"  class="add-depart" data-toggle="modal" data-target="#addSectionModal">Добавить раздел</button>
        <button data-cid="marks" type="button"  class="add-depart" data-toggle="modal" data-target="#addMarkModal">Добавить марку</button>
        <button data-cid="departments" type="button"  class="add-depart" data-toggle="modal" data-target="#addDepartmentModal">Добавить отдел</button>
        <button data-cid="roles" type="button"  class="add-depart" data-toggle="modal" data-target="#addRoleModal">Добавить должность</button>

        <span></span>
    </nav>

    <nav class="handbooks reports">
        <ul>
            <li class="data-list" data-cid="reports"><a href="{% url 'reports' %}">Трудозатраты по объектам</a></li>
            <li class="data-list" data-cid="reports-employees"><a href="{% url 'reports-employees' %}">Трудозатраты по сотрудникам</a></li>
            <li class="data-list" data-cid="final-report"><a href="{% url 'final-report' %}">Итоговый отчет</a></li>
        </ul>
        <form method="get" action="{% url 'export_to_excel' %}" data-cid="final-report" class="export-exel-form">
            <input type="hidden" name="start_date" value="{{ start_date }}">
            <input type="hidden" name="end_date" value="{{ end_date }}">
            <button type="submit" class="add-depart active">Экспорт в Excel</button>
        </form>

        <span></span>
    </nav>

    <main>
        {% block content %}
        {% endblock %}
    </main>

    <div class="datepicker-container" style="display: none;">
        <div class="datepicker">
            <div class="datepicker-header">
                <button class="prev">
                    <svg xmlns="http://www.w3.org/2000/svg" width="7" height="12" viewBox="0 0 7 12" fill="none">
                        <path d="M5.421 10.9965L0.771484 6.34702L5.421 1.69751" stroke="#202020" stroke-width="1.54984" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                <div>
                    <select class="month-input">
                        <option>Январь</option>
                        <option>Февраль</option>
                        <option>Март</option>
                        <option>Апрель</option>
                        <option>Май</option>
                        <option>Июнь</option>
                        <option>Июль</option>
                        <option>Август</option>
                        <option>Сентябрь</option>
                        <option>Октябрь</option>
                        <option>Ноябрь</option>
                        <option>Декабрь</option>
                    </select>
                    <input type="number" class="year-input" />
                </div>
    
                <button class="next">
                    <svg xmlns="http://www.w3.org/2000/svg" width="7" height="12" viewBox="0 0 7 12" fill="none">
                        <path d="M1.26953 10.9965L5.91904 6.34702L1.26953 1.69751" stroke="#202020" stroke-width="1.54984" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
    
            <div class="days">
                <span>вс</span>
                <span>пн</span>
                <span>вт</span>
                <span>ср</span>
                <span>чт</span>
                <span>пт</span>
                <span>сб</span>
            </div>
    
            <div class="dates"></div>
        </div>
    </div>

</div>
</body>
<script>

    document.addEventListener('DOMContentLoaded', () => {
        const currentUrlPath = window.location.pathname.split('/')[1],
            adminBtnsListItem = document.querySelectorAll('.admin-main-navigation ul li'),
            adminHandbooksNavList = document.querySelector('.handbooks'),
            adminReportsNavList = document.querySelector('.handbooks.reports'),
            adminLinksListItem = document.querySelectorAll('.data-list'),
            adminLinksBtnsListItem = document.querySelectorAll('.add-depart'),
            adminMainNavigation = document.querySelector('.admin-main-navigation'),
            exportExelForms = document.querySelector('form.export-exel-form'),
            header = document.querySelector('header'),
            laborCostsProjects = document.querySelector('li.data-list[data-cid="reports"]'),
            laborCostsProjectsSwitcher = document.querySelector('li.data-list[data-cid="reports"] p'),
            laborCostsProjectsBtn = document.querySelector('button[data-cid="reports"]'),
            laborCostsProjectsTable = document.querySelector('#laborCostsProjectsTable'),
            laborCostsSections = document.querySelector('li[data-cid="labor-costs-sections"]'),
            laborCostsSectionsSwitcher = document.querySelector('li.data-list[data-cid="labor-costs-sections"] p'),
            laborCostsSectionsBtn = document.querySelector('button[data-cid="labor-costs-sections"]'),
            laborCostsProjectsForm = document.querySelector('#laborCostsProjectsForm'),
            laborCostsSectionsForm = document.querySelector('#laborCostsSectionsForm'),
            laborCostsSectionsTable = document.querySelector('#laborCostsSectionsTable'),
            dateInputStart = document.querySelector('input.date-input[name=start_date]'),
            dateInputEnd = document.querySelector('input.date-input[name=end_date]'),
            isAdmin = '{{user.is_admin}}';

        function dataMining(selector, urlPath) {
            selector.forEach(item => {
                item.classList.remove('active');
                if(urlPath == item.dataset.cid) {
                    item.classList.add('active');
                }
            });
        }

        function setStatusForUpperList(selector, target) {
            selector.forEach(item => {
                item.classList.remove('active')
                if(item.dataset.cid == target) {
                    item.classList.add('active');
                }
            })
        }

        if(isAdmin) {

            const div = document.createElement('div');

            if(currentUrlPath != '') {
                const adminBlock = document.querySelector('#adminDiv');

                div.innerHTML =
                `
                <p class="admin_info"><a href="/">Нажмите</a>, чтобы перейти на страницу для заполнения отчета</p>
                `;

                div.style.marginBottom = '40px'

                adminBlock.append(div);

            } else {
                const adminBlock = document.querySelector('#create');

                div.innerHTML =
                `
                <p class="admin_info"><a href="{% url 'timelog-list' %}">Нажмите</a>, чтобы перейти на страницу администратора</p>
                `;

                adminBlock.append(div);
            }
        }

        function setStatus (url, mainList, secondaryList, secondaryListBtns) {
            adminHandbooksNavList.style.display = 'none';
            adminReportsNavList.style.display = 'none';
            adminMainNavigation.style.display = 'block';
            header.style.display = 'flex';
            exportExelForms.classList.remove('active');

            switch (url) {
                case 'login':
                    adminMainNavigation.style.display = 'none';
                    header.style.display = 'none';
                    const showPass = document.querySelector('.pass-input svg'),
                        passInput = document.querySelector('.pass-input input[type=password]')
                    
                    showPass.addEventListener('mousedown', () => {
                        passInput.setAttribute('type', 'text');
                    });

                    showPass.addEventListener('mouseup', () => {
                        passInput.setAttribute('type', 'password');
                    });

                case 'timelogs':
                    dataMining(mainList, url);
                    break;

                case 'users':
                    dataMining(mainList, url);
                    break;
                    
                case 'projects':
                case 'sections':
                case 'marks':
                case 'departments':
                case 'roles':
                    setStatusForUpperList(mainList, 'projects');
                    dataMining(secondaryList, url);
                    dataMining(secondaryListBtns, url);
                    adminHandbooksNavList.style.display = 'flex';
                    break;

                case 'reports':
                case 'reports-employees':
                case 'final-report':
                    dataMining(mainList, 'reports');
                    adminReportsNavList.style.display = 'flex';
                    dataMining(secondaryList, url);
                    exportExelForms.classList.add('active');
                    break;

                default:
                    adminHandbooksNavList.style.display = 'none';
                    adminMainNavigation.style.display = 'none';
                    break;
            }
        }

        setStatus(currentUrlPath, adminBtnsListItem, adminLinksListItem, adminLinksBtnsListItem);

        const datepicker = document.querySelector(".datepicker-container");
        let activeInput = null;

        const openDateModal = (input) => {
            activeInput = input;
            const wrapper = input.closest(".datepicker-wrapper");
            wrapper.appendChild(datepicker);
            datepicker.style.display = 'block';
        };

        const closeDateModal = () => {
            datepicker.style.display = 'none';
            activeInput = null;
        };

        document.querySelectorAll('[data-cid="calendar"]').forEach((input) => {
            input.addEventListener("click", (e) => {
                e.preventDefault();
                openDateModal(input);
            });
        });

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.datepicker-container') && !e.target.closest('[data-cid="calendar"]')) {
                closeDateModal();
            }
        });

        const yearInput = datepicker.querySelector(".year-input"),
              monthInput = datepicker.querySelector(".month-input"),
              nextBtn = datepicker.querySelector(".next"),
              prevBtn = datepicker.querySelector(".prev"),
              dates = datepicker.querySelector(".dates"),
              adminBlock = document.querySelector('#adminBlock');

        let selectedDate = new Date();
        let year = selectedDate.getFullYear();
        let month = selectedDate.getMonth();

        nextBtn.addEventListener("click", (e) => {
            if (month === 11) year++;
            month = (month + 1) % 12;
            displayDates();
            e.preventDefault();
        });

        prevBtn.addEventListener("click", (e) => {
            if (month === 0) year--;
            month = (month - 1 + 12) % 12;
            displayDates();
            e.preventDefault();
        });

        monthInput.addEventListener("change", () => {
            month = monthInput.selectedIndex;
            displayDates();
        });

        yearInput.addEventListener("change", () => {
            year = yearInput.value;
            displayDates();
        });

        const updateYearMonth = () => {
            monthInput.selectedIndex = month;
            yearInput.value = year;
        };

        const handleDateClick = (e) => {
            e.preventDefault();
            const button = e.target;
            const selected = dates.querySelector(".selected");
            selected && selected.classList.remove("selected");

            button.classList.add("selected");
            selectedDate = new Date(year, month, parseInt(button.textContent));
        };

        const Apply = (e) => {
            if (activeInput) {
                activeInput.value = selectedDate.toLocaleDateString("ru-RU", {
                    weekday: 'short',
                    year: "numeric",
                    month: "2-digit",
                    day: "2-digit",
                });
            }
            closeDateModal();
            e.preventDefault();
        };

        const displayDates = () => {
            updateYearMonth();
            dates.innerHTML = "";

            const lastOfPrevMonth = new Date(year, month, 0);
            for (let i = 0; i <= lastOfPrevMonth.getDay(); i++) {
                const text = lastOfPrevMonth.getDate() - lastOfPrevMonth.getDay() + i;
                const button = createButton(text, true, -1);
                dates.appendChild(button);
            }

            const lastOfMonth = new Date(year, month + 1, 0);
            for (let i = 1; i <= lastOfMonth.getDate(); i++) {
                const button = createButton(i, false);
                button.addEventListener("click", handleDateClick);
                button.addEventListener("dblclick", Apply);
                dates.appendChild(button);
            }

            const firstOfNextMonth = new Date(year, month + 1, 1);
            for (let i = firstOfNextMonth.getDay(); i < 7; i++) {
                const text = firstOfNextMonth.getDate() - firstOfNextMonth.getDay() + i;
                const button = createButton(text, true, 1);
                dates.appendChild(button);
            }
        };

        const createButton = (text, isDisabled = false, type = 0) => {
            const currentDate = new Date();
            let comparisonDate = new Date(year, month + type, text);

            const isToday = currentDate.getDate() === text && currentDate.getFullYear() === year && currentDate.getMonth() === month;
            const selected = selectedDate.getTime() === comparisonDate.getTime();

            const button = document.createElement("button");
            button.textContent = text;
            button.disabled = isDisabled;
            button.classList.toggle("today", isToday && !isDisabled);
            button.classList.toggle("selected", selected);
            return button;
        };

        displayDates();

        // Логика выбора периода и расчет дат
        const selectPeriod = document.querySelector('.select[data-cid="select-for-calendar"]');
        if (selectPeriod) {
            const selectCurrent = selectPeriod.querySelector('.select__current');

            const calculateDateRange = (period) => {
                const endDate = new Date();
                let startDate = new Date();
                
                switch (period) {
                    case 'Неделя':
                        startDate.setDate(endDate.getDate() - 7);
                        break;
                    case 'Месяц':
                        startDate.setMonth(endDate.getMonth() - 1);
                        break;
                    case '3 месяца':
                        startDate.setMonth(endDate.getMonth() - 3);
                        break;
                    case 'Пол года':
                        startDate.setMonth(endDate.getMonth() - 6);
                        break;
                    case 'Год':
                        startDate.setFullYear(endDate.getFullYear() - 1);
                        break;
                    default:
                        return;
                }

                return { startDate, endDate };
            };

            const updateInputDates = (startDate, endDate) => {
                dateInputStart.value = startDate.toLocaleDateString("ru-RU");
                dateInputEnd.value = endDate.toLocaleDateString("ru-RU");
            };

            const displayDatesInCalendar = (startDate, endDate) => {
                const start = new Date(startDate.getFullYear(), startDate.getMonth(), startDate.getDate());
                const end = new Date(endDate.getFullYear(), endDate.getMonth(), endDate.getDate());

                year = start.getFullYear();
                month = start.getMonth();
                displayDates();

                dates.querySelectorAll("button").forEach(button => {
                    const buttonDate = new Date(year, month, parseInt(button.textContent));

                    if (buttonDate >= start && buttonDate <= end) {
                        button.classList.add("selected-range");
                    } else {
                        button.classList.remove("selected-range");
                    }
                });
            };

            selectPeriod.addEventListener('click', function(event) {
                if (event.target.classList.contains('select__item')) {
                    const period = event.target.innerText;
                    selectCurrent.innerText = period;
                    const { startDate, endDate } = calculateDateRange(period);
                    updateInputDates(startDate, endDate);
                    displayDatesInCalendar(startDate, endDate);
                }
            });
        }

        // Универсальная логика для простых селектов
        document.addEventListener('click', function(event) {
            const target = event.target;

            if (target.closest('.select')) {
                const select = target.closest('.select');
                select.classList.toggle('is-active');

                document.querySelectorAll('.select.is-active').forEach(otherSelect => {
                    if (otherSelect !== select) {
                        otherSelect.classList.remove('is-active');
                    }
                });
            } else {
                document.querySelectorAll('.select.is-active').forEach(select => {
                    select.classList.remove('is-active');
                });
            }

            if (target.classList.contains('select__item') && target.closest('.select[data-cid="simple-select"]')) {
                const selectItem = target;
                const select = selectItem.closest('.select');
                const currentText = select.querySelector('.select__current');

                // Устанавливаем текст и значение выбранного элемента
                currentText.innerText = selectItem.innerText;
                currentText.setAttribute('data-value', selectItem.getAttribute('data-value'));

                // Находим скрытое поле и обновляем его значение
                const hiddenInput = select.parentNode.querySelector('.hidden-input');
                if (hiddenInput) {
                    hiddenInput.value = selectItem.getAttribute('data-value');
                }

                // Закрываем селект
                select.classList.remove('is-active');

                inputsChecker();
            }
        });
    });

    


</script>
</html>
